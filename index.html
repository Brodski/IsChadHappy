<html>
    <script src ="key.js"  type="text/javascript"> </script>
    <script>
    

    window.addEventListener('load', (event) => {
        console.log(`
        .   mm:+.      .                '''''....-
        s/''MMN://    +m-   .           '''''....-
        +No:NMMN/-o/ 'NMh+ :d'  :d       '''''...-
   /:   :MN+yMMMN:.:s+MMy+sodo 'Nd+       ''''....
:. .Ns/' mMMs:yNMN:'./dMM/-yN/++Moo-      '''''...
'h/+ym+o+oMMMs:+omN+':.:ym/'::/mMy'y..y    ''''...
 dshNMNs+hNMMMy-+-/y+.s''.+-''.:dN:-hyN/   '''''..
 sN+NdMMdsmMMMM+.y'.-.d.---.-'-:.+h.:Nmy  . '''''.
.:MmymdMMNNMMMMN/s-/-omsysyss:.:''/+':d/::h' ''''.
:sNMMMMMMMMMMMMMN/+ydhy:sy:dsyy/'''-.-.-+hh: '''''
:MMmMMMMMMhmmMNmMyo/:......-.-os-''''+''-mh+'.''''
-MMdNMNhdh::-o::o+.............+h--''+'''-o/s/''''
.NNMNMd.:......................-+y+''''''.'-No '''
'NNMMMm...................--.....:h:-:''':'ooh -''
/hMMMMd-.............../ooooso....+dyo'''.'y.h:d''
-NMMMMo..../+o+/-.....//-....-.....-/s'''''-'+NN/:
 yMMMMy../s+-.--........--://:::-...-s'.-''  .dmy'
 .NmMMm../-.----........+o/+syyo/....o:/d+:'.:-h''
  +mNMM/..-//+so/.+/....-..-:--....../sssyy+''+-''
  +dNMMd.-s++sss:.yo..................sy+ohd.-+'''
  /NMMMMs..-...../M/.................-m+-/Ny:+''''
   :hMMMM/.......+mm.::...............+.-dhhy.'''.
     /dMMy........-o-......:/........-y.sh:N+'''..
      'sMN-..............-/+.........:Ns/:yy......
       'mMy.....://:...-//-..........:h'-/h.....--
        .dMs.......-----::...........o+:'y/...---:
         'yNs....../oyhs/..........-syso/d..---:::
           -/s-..................-ym+.omN+.---:://
             .h/...............-sNh-../NM:--::://+
              -my-.........../yNm/....:sNssyys+++:
               -Nm/......./yNMNo......./y.-:sNNh- 
                /ydhsssydNMMNs-......../homMMm+d' 
                -h-oNMMMMNh+...........-MMMMy:.o+ 
            '/yhyms.-hmo/.....y-........mMm:''.+h/
`)
        console.log("--------")
        console.log("Welcome to IsChadHappy! The website dedicated on checking the emotional status of Chad.")
        console.log("Questions? Comments? Concerns?")
        console.log("Contact me --> CharlesMcMurphy1@gmail.com")   
        console.log("") 
        console.log("Cheers") 
        console.log("Charles McMurphy") 
        console.log("--------\n\n\n\n\n\n\n\n") 
        go()
    });

        // IDs = https://riot-api-libraries.readthedocs.io/en/latest/ids.html
        // 
        //
        // Summoner-V4 API will give something like this:
        // llIlllIlllIII
        // {
               // id = encryptedId     <---------------------
               // id = encryptedId     <---------------------
               // id = encryptedId     <---------------------
        //     "id": "yMlvFkenH7voKiw6uq-NFWNjAZ17OuEXAJcYLZ4aYO96wuH0IgU8pyXJwQ", 
        //     "accountId": "VgcPLU0shoSNHfdEcOaCmfsArHsTYwU5kq_NZJGpHAKLYM-3rcaGIV-T",
        //     "puuid": "pEX94E8v3YLw8YQRcyfxO3Z8NEfp59fa_mZkplsE1JUwzash8p-ABkOOF33iIWQReQ9ipj5SkbFSFA",
        //     "name": "llIlllIlllIII",
        //     "profileIconId": 3795,
        //     "revisionDate": 1657816755121,
        //     "summonerLevel": 124
        // }


        // "hi im washed up"
        // {
        //     "id": "4ZMNRZfEp2-G-GT26iRzY_2V2ax4O_EpCPHr_J2pPtTTUBk",
        //     "accountId": "UcC-68qMZApASgog5IGLB6h0CGO4Xmk9kP_tH_T_Xa_UxQ8",
        //     "puuid": "iFhVmBOF2Oah0NEV3nv3M9knkbnwqxIR9Fo99frhvAdEPLp0jClEIEvSC5CeJMry5tqUtmwYtB5YmQ",
        //     "name": "hi im washed up",
        //     "profileIconId": 984,
        //     "revisionDate": 1650313166000,
        //     "summonerLevel": 162
        // }

        // Pog Mode (Main)
        // {
        //     "id": "LuzJS1vMXfQOJmsqI83QLykbRzrz1FLA1JoqmGtNxvQIhec",
        //     "accountId": "oKx14jCuKKqJDVQMgp4-c1byJlOKfiNTEPLjtt3aV6YVbeg",
        //     "puuid": "tk7S6I1iYphuLxR43aIan_7GeUJ3yxJjfoH9k_D9KqmYbly5chpAZcEVAM9BdQyBiVr4Ss-lsbTC7w",
        //     "name": "Pog Mode",
        //     "profileIconId": 4076,
        //     "revisionDate": 1658466593947,
        //     "summonerLevel": 279
        // }

        // OLD
        // 1. Look up Summoner by in game name      https://developer.riotgames.com/apis#summoner-v4/GET_getBySummonerName
        // 2. Then by encryptedSummonerId (recieved from 1) https://na1.api.riotgames.com/lol/league/v4/entries/by-summoner/
        // 3. Render

        // New
        // 1. Look up encryptedSummerIds (2 above)
        // 2. Render

        
    /************************************************************************/
    /************************************************************************/
    /************************************************************************/
    /************************************************************************/
    /************************************************************************/
    /************************************************************************/
    /********************                               *********************/
    /********************                               *********************/
    /********************          JAVASCRIPT           *********************/
    /********************                               *********************/
    /********************                               *********************/
    /************************************************************************/
    /************************************************************************/
    /************************************************************************/
    /************************************************************************/
    /************************************************************************/
    /************************************************************************/

    let a_key = getKey();
    let happySrc = "./happy.png"
    let sadSrc = "./sad.png"
    
    class Account {
        constructor(someObject) {
            this.id = someObject?.id; // id = encryptedId
            this.name = someObject?.name;
            this.namesAll = someObject?.namesAll;

            this.winsLol = null;
            this.losesLol = null;

            this.winsTft = null;
            this.losesTft = null;
        }

        async getRankedLolById() {
            let rankingFetchUrl = "https://na1.api.riotgames.com/lol/league/v4/entries/by-summoner/" + this.id + "?api_key=" + a_key;
            let responseJson = await this.makeRequest(rankingFetchUrl, "Failed getting rank :( ", 'HTTP request error! Failed to get ranking info.  Status: ');
            return responseJson            
        }
        

        async getIdByName() {
            let summonerFetchUrl = "https://na1.api.riotgames.com/lol/summoner/v4/summoners/by-name/" + this.name + "?api_key=" + a_key;
            let responseJson = await this.makeRequest(summonerFetchUrl, "Failed, probably a name change", 'HTTP request error! Failed to get Id.  Status: ');
            

            console.log(responseJson)
            console.log("IMPORTANT! add this ID to Accounts array ---->");
            console.log("IMPORTANT! add this ID to Accounts array ---->");
            console.log("IMPORTANT! add this ID to Accounts array ---->");
            console.log("IMPORTANT! add this ID to Accounts array ---->");
            console.log(this.name + "   :   " + responseJson.id  )
            console.log(this.name + "   :   " + responseJson.id  )
            console.log(this.name + "   :   " + responseJson.id  )
            console.log(this.name + "   :   " + responseJson.id  )
            console.log(this.name + "   :   " + responseJson.id  )
            console.log(this.name + "   :   " + responseJson.id  )
            console.log(this.name + "   :   " + responseJson.id  )
            console.log(this.name + "   :   " + responseJson.id  )
            console.log(responseJson.id)

            return responseJson.id
        }

        async getTft() {
            let tftFetchUrl = "https://na1.api.riotgames.com/tft/league/v1/entries/by-summoner/" + this.id + "?api_key=" + a_key;
            console.log("TFT ", tftFetchUrl)
            let responseJson = await this.makeRequest(tftFetchUrl, "Failed, getting TFT rank", 'HTTP request error! Failed to get Id.  Status: ');

            console.log("TFT")
            console.log("TFT")
            console.log("TFT")
            console.log(responseJson)
            return responseJson
        }

        async makeRequest(fetchUrl, errorMsgRender="", errorMsgLog="" ) {
            let response = await fetch(fetchUrl).catch( () => console.log("failed request :("));
            
            if (!response || !response.ok) { 
                let msg =  response ? response.ok : errorMsgRender
                renderSomethingWentWrong(msg)
                console.error(errorMsgLog + " " + msg); 
                return "error"
            } 
            let responseJson = await response.json()
            return responseJson;
        }
    }
    
    
    let bannedArr = ["Pog Mode","hi im washed up"]
    let allAccounts = [ 
        new Account({
            id: "AQ36Zl7hI8x5xx3C6y3-nZ6Fa-z-xwqMMrbFnDZEu3EHh6QhZvT6MEBL2Q",
            name: "llIlllIlllIII",
            namesAll: ["llIlllIlllIII", "Hi I'm Boomer"]
        }),
        new Account({
            id: "VpZZheO1UOaC3XDcUpD0cDkCkD5pTCBMkR36bCd534uboPk",
            name: "hi im washed up",
            namesAll: ["hi im washed up"]
        }), 
        new Account({
            id: "oVvwQO9XPxojZURXibfAUOqWXl0M4Fvxk-qM64DMKO4u8JA", 
            name: "Pog Mode",
            namesAll: ["Pog Mode"]    
        }),
        new Account({
            id: "nIQ6RHVUyx3RPIDlW4qsKsBt-sNezBb4zqvBwouYn1h6-AM",
            name: "keine Hosen",
            namesAll: ["keine Hosen"]
        }),
        new Account({
            id: "WU0939L93pHADU1N-Xz6IRHmE5HttLS29UmLR1pWLD8EbTE",
            name: "Geraniho",
            namesAll: ["Geraniho"]
        }),
    ];

    async function go() {
        console.log("************************************");
        console.log("******* Start fetching data ********");
        console.log("************************************");
        let tftRank = await allAccounts[0].getTft()
        // return
        let allRankings = [];
        for (let account of allAccounts) {
            if (!account.id) {
                console.log("GGetting account info my name")
                let accountId = await account.getIdByName(); 
                account.id = accountId;
            } 
            let rank = await account.getRankedLolById()
            if (rank.summonerName) { 
                account.name = rank.summonerName 
            }
            console.log("Rank for id: " + account.id)
            console.log(rank)

            // let tftRank = await account.getTft();

            if (rank != "error") { // again, shitty error checking. Also repeated code
                for (let type of rank){
                    if (type.queueType == "RANKED_SOLO_5x5"){
                        allRankings.push(type)                    
                    }
                }
            }
            console.log(rank)
        }
        console.log("************************************");
        console.log("*******  End fetching data  ********");
        console.log("************************************");
        console.log("");
        console.log("");
        console.log("");
        console.log("^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^")
        console.log("^^^^^    Start Rendering     ^^^^^^")
        console.log("^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^")
        console.log("allRankings")
        console.log("allRankings")
        console.log("allRankings")
        console.log(allRankings)
        renderRanking(allRankings)
    }

    function renderRanking(rankings) {
        let isChadHappy = true
        let wins = 0;
        let losses = 0;
 
        for (let rank of rankings) {
            let queueType =  rank.queueType
            let divsion =  rank.rank
            let tier = rank.tier
            let points = rank.leaguePoints
            let summonerName = rank.summonerName
            let info = {
                tier: rank.tier,
                divsion:  rank.rank,
                points: rank.leaguePoints,
                winLose: rank.wins + " - " + rank.losses
            }


            wins = wins + rank.wins;
            losses = losses + rank.losses;
            let ul = document.createElement("ul")
            let anch = document.createElement("a")
            anch.setAttribute('href', 'https://na.op.gg/summoners/na/' + rank.summonerName)
            anch.setAttribute('target', '_blank')
            anch.setAttribute('rel', 'noopener noreferrer')
            anch.innerText = bannedArr.includes(rank.summonerName) ? rank.summonerName + " (BANNED)" : rank.summonerName 
            ul.appendChild(anch)
            document.getElementById("main").append(ul)
            for (const [key, val] of Object.entries(info)) {
                if (key=='tier' 
                    && !bannedArr.includes(rank.summonerName)
                    && (val.toUpperCase() == "MASTER" || val.toUpperCase() == "GRANDMASTER")) {
                    // chadStatText = "Chad is sad &#128546;"
                    isChadHappy = false
                }
                console.log(key + ": " + val);
                let info = key + ": " + val
                let li = document.createElement("li")
                li.innerText = info
                ul.append(li)
            }
            setTimeout( () => {positionAccountsOnMeter(info,summonerName)}, 500)
            
        }
        let ul = document.createElement("ul")
        let li = document.createElement("li")
        ul.innerText = "Total"
        li.innerText = "winLose: " + wins + " - " + losses
        ul.append(li)
        document.querySelector("#main").before(ul)

        let imgSrc = isChadHappy ? happySrc : sadSrc
        let chadStatText = isChadHappy ? "Chad is happy " : "Chad is sad " 
      
        let ladder = document.getElementById("ladder-wrap")
        if (ladder) {
            ladder.style.visibility = "visible";
        }

        document.getElementById("chadStatus").innerHTML = ` <div> ${chadStatText} </div> <img src=${imgSrc} ></img>`;    
  
    }

    function positionAccountsOnMeter(info, summonerName) {
        // let info = {
        //         tier: rank.tier,
        //         divsion:  rank.rank,
        //         points: rank.leaguePoints,
        //     }
        const runIt = () => {
            // console.log("**********************************************" )
            // console.log(summonerName )
            // console.log(info )
            let division;
            let maxPoints = 100;
            if (info.tier.toUpperCase() == "DIAMOND") {
                maxPoints = 100;
                switch (info.divsion.toUpperCase()) {
                    case 'I':
                        division = document.querySelector("#d1")
                        console.log("Found d1")
                        console.log(division)
                        break
                    case 'II':
                        division = document.querySelector("#d2")
                        console.log("Found d2")
                        console.log(division)
                        break
                    case 'III':
                        division = document.querySelector("#d3")
                        console.log("Found d3")
                        console.log(division)
                        break
                    case 'IV':
                        division = document.querySelector("#d4")
                        console.log("Found d4")
                        console.log(division)
                        break
                }
            }
            if (info.tier.toUpperCase() == "MASTER") {
                division = document.querySelector("#masters")
                maxPointsAux = 300
                maxPoints = maxPointsAux
                if (info.points > maxPointsAux ) {
                    maxPoints = info.points + 100
                }
            }
            if (info.tier.toUpperCase() == "GRANDMASTER") {
                division = document.querySelector("#gm")
                maxPoints = 700;
            }

            if (!division) {
                console.log("division not found :(")
                return
            }

            // let offset = division.getBoundingClientRect().height - (info.points / 100) * division.getBoundingClientRect().height
            let offset = division.getBoundingClientRect().height * (1 - (info.points / maxPoints))
            // console.log("Bounding" ,division.getBoundingClientRect())
            // console.log("top" ,division.getBoundingClientRect().top)
            // console.log("info.points" , info.points)
            // console.log("info.points /100" , info.points/maxPoints)
            // console.log("offset" , offset)
            let account;
            if (document.getElementById(summonerName.replace(/\s/g, "")) ) {
                account = document.getElementById(summonerName.replace(/\s/g, ""))
            } else {
                account = document.createElement("div")
                account.id = summonerName.replace(/\s/g, "");
                account.innerText = bannedArr.includes(summonerName) ? "☠️" + summonerName : summonerName;
                // account.innerText = summonerName
                document.body.appendChild(account)
                account.classList.add("meter-accounts")
            }
            let bannedOffset = 0;
            if (bannedArr.includes(summonerName) && info.points == 75) {
                bannedOffset = bannedArr.indexOf(summonerName) * 15;
                if (bannedArr.indexOf(summonerName) > 0) {
                    account.classList.add("disabled-hyphen")                    
                }
            }
            account.style.top = (division.getBoundingClientRect().top + offset + bannedOffset) + "px"
            account.style.left = (division.getBoundingClientRect().left) + "px"
        }
        runIt()
        window.addEventListener("resize", runIt)

    }
    
    function renderSomethingWentWrong(msg) {
        let myDiv = document.createElement("div") 
        myDiv.innerHTML = `<div> Something went wrong in a HTTP Request :( <br/>Error="${msg}"</div> `
        
        document.getElementsByTagName("body")[0].append(myDiv)
    }

    </script>

    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- //////////////////                   //////////////////////// -->
    <!-- //////////////////                   //////////////////////// -->
    <!-- //////////////////                   //////////////////////// -->
    <!-- //////////////////        CSS        //////////////////////// -->
    <!-- //////////////////                   //////////////////////// -->
    <!-- //////////////////                   //////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <style>
        .wrapper {  
            display: flex;
        }
        .img-wrap {
            padding-left: 35px;
            width: 200px;
        }
        .img-wrap img {
            width: 100%
        }
        #ladder-wrap {
            display: flex;
            visibility: hidden;
            background-color: #e7e7e7;
        }
        .meter-wrap {
            min-width: 98px;
            padding: 20px;
            display: inline-flex;
        }
        .meter {
            border: 2px solid black;
            height: 100%;
            width: var(--meter-width) ;
            display: flex;
            justify-content: space-evenly;
            justify-content: space-between;
            flex-direction: column;            
        }
        .meter > div {
            border-bottom: 2px solid black;
            position: relative;
            height: 100%;
            
        }
        .meter > div > .rank-text {
            writing-mode: tb-rl;
            height: 100%;
            right: 0;
            text-align: center;
            font-size: 16px;
            transform: translateX(100%);
            position: absolute;
        }

        .meter > div:nth-child(-n + 2) {
            background-color: #97008e6b;
        }
        .meter > div:nth-last-child(-n + 4) {  
            background-color: #3333ff54;
        }


        #chadStatus {
            display: inline-flex;
            font-size: 30px;
            font-weight: 600;
        }
        #chadStatus div:first-child {
            align-self: center;
        }
        #chadStatus img {
            width: auto;
            height: 270px;
        }
        ul {
            font-weight: 600;
        }
        li {
            font-weight: 400;
            list-style: circle;
        }
        #img-masters {
            width: 88%;
        }
        
        .vert {
            text-orientation: upright;
            writing-mode: vertical-lr;
            letter-spacing: -4px;
            color: #0000008a;
        }
         #happy-vert {
            
            font-size: 20px;
            font-weight: 900;
            text-align: end;
            
        }
        #sad-vert {
            
            font-size: 20px;
            font-weight: 900;
            
        }

        #happy-divider {        
            border-bottom: 2px solid black;
            margin-right: 4px;
            margin-left: 4px;
            margin-top: 14px;
            margin-bottom: 14px;
        }
        #happy-sad-vert {

            display: flex;
            height: 74%;
            padding-right: 7px;
            justify-content: center;
            flex-direction: column;
        }

        #big-divider {
            display: flex;
            justify-content: center;
            /* background: linear-gradient( 90deg , white, white 45%, #000000b0 50%, white 55%, white); */
            flex-direction: column;
            width: 25px;
        }
        .meter-accounts {
            position:absolute;
            transform: translateY(-50%);
            padding-left: 15px;
            max-width: calc( var(--meter-width) - var(--account-padding ));
            text-overflow: ellipsis;
            overflow: hidden;
            font-size: 14px;
            height: 17px;
            line-height: 18px;
        }
        .meter-accounts::before {
            content: " ";
            width: 12px;
            left: 0;
            position: absolute;
            height: 50%;
            border-bottom: 2px solid black;
        }
        .disabled-hyphen::before {
            content: unset;
        }
        :root {
            --account-padding: 15px;
            --meter-width: 100px;
        }
    </style>
    
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- //////////////////                   //////////////////////// -->
    <!-- //////////////////                   //////////////////////// -->
    <!-- //////////////////                   //////////////////////// -->
    <!-- //////////////////        HTML       //////////////////////// -->
    <!-- //////////////////                   //////////////////////// -->
    <!-- //////////////////                   //////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <!-- ///////////////////////////////////////////////////////////// -->
    <body>
        <div class="wrapper">
            <div>
                <div id="chadStatus"> </div>
                <div id="main"> </div>
            </div>
            <div id="big-divider" > 
                <div>  </div>
            </div>
            <div id="ladder-wrap">
                <div class="meter-wrap" >

                    <div id="happy-sad-vert"> 
                        <div class="vert" id="sad-vert"> SAD </div>
                        <div class="vert" id="happy-divider"></div>
                        <div class="vert" id="happy-vert"> HAPPY </div>
                    </div>
                    <div class="meter"> 
                        <div id="gm">
                            <div class="rank-text" > GM </div>
                        </div>
                        <div id="masters"> 
                            <div class="rank-text" > Masters </div>
                        </div>
                        <div id="d1"> 
                            <div class="rank-text" > D1 </div>
                        </div>
                        <div id="d2">
                            <div class="rank-text" > D2 </div>
                        </div>
                        <div id="d3"> 
                            <div class="rank-text" > D3 </div>
                        </div>
                        <div id="d4"> 
                            <div class="rank-text" > D4 </div>
                        </div>
                    </div>
                    
                </div>
                <div class="img-wrap">
                    <img id="img-masters" src="./masters.png" />
                    <img id="img-diamond" src="./diamond-trash2.png" />
                </div>
            </div>
        </div>
    </body>
</html>















